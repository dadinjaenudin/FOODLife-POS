{% extends 'base.html' %}

{% block title %}POS - {{ request.user.outlet.name }}{% endblock %}

{% block content %}
{% csrf_token %}

<!-- ==================================================
     POS MAIN INTERFACE - 3 COLUMN LAYOUT
     1. Left: Icon-only sidebar navigation (64px)
     2. Center: Main content with header, categories, products, footer (flex-1)
     3. Right: Bill panel with order summary (384px)
     ================================================== -->
<div class="flex h-screen bg-gray-50">
    
    <!-- ==================== LEFT: SIDEBAR (ICON ONLY) ==================== -->
    <aside class="w-16 bg-gray-900 text-white flex flex-col">
        
        <!-- Branding Logo -->
        <div class="h-16 flex items-center justify-center border-b border-gray-800">
            <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </div>
        
        <!-- Main Navigation Links -->
        <nav class="flex-1 py-4 overflow-y-auto">
            <!-- Dashboard -->
            <a href="{% url 'management:dashboard' %}" 
               class="flex items-center justify-center h-12 hover:bg-gray-800 transition-colors"
               title="Dashboard">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            </a>
            
            <!-- Menu Order (Active) -->
            <a href="{% url 'pos:main' %}" 
               class="flex items-center justify-center h-12 bg-blue-600"
               title="Menu Order">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
            </a>
            
            <!-- Analytics -->
            <a href="{% url 'management:reports' %}" 
               class="flex items-center justify-center h-12 hover:bg-gray-800 transition-colors"
               title="Analytics">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
            </a>
            
            <!-- Tables -->
            <a href="{% url 'tables:floor_plan' %}" 
               class="flex items-center justify-center h-12 hover:bg-gray-800 transition-colors"
               title="Tables">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
            </a>
            
            <!-- Divider -->
            <div class="h-px bg-gray-700 mx-2"></div>
            
            <!-- Kitchen Display -->
            <a href="{% url 'kitchen:kds_station' 'kitchen' %}" 
               target="_blank"
               class="flex items-center justify-center h-12 hover:bg-orange-600 transition-colors group relative"
               title="Kitchen Station">
                <span class="text-2xl">üßë‚Äçüç≥</span>
            </a>
            
            <!-- Bar Display -->
            <a href="{% url 'kitchen:kds_station' 'bar' %}" 
               target="_blank"
               class="flex items-center justify-center h-12 hover:bg-purple-600 transition-colors group relative"
               title="Bar Station">
                <span class="text-2xl">üçπ</span>
            </a>
            
            <!-- Dessert Station -->
            <a href="{% url 'kitchen:kds_station' 'dessert' %}" 
               target="_blank"
               class="flex items-center justify-center h-12 hover:bg-pink-600 transition-colors group relative"
               title="Dessert Station">
                <span class="text-2xl">üç∞</span>
            </a>
        </nav>
        
        <!-- Bottom Action Buttons -->
        <div class="border-t border-gray-800">
            <!-- Settings -->
            <a href="{% url 'management:settings' %}" 
               class="flex items-center justify-center h-12 hover:bg-gray-800 transition-colors"
               title="Settings">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </a>
            
            <!-- Logout -->
            <a href="{% url 'core:logout' %}" 
               class="flex items-center justify-center h-12 hover:bg-red-600 transition-colors"
               title="Logout">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
            </a>
        </div>
    </aside>
    
    <!-- ==================== CENTER: MAIN CONTENT ==================== -->
    <main class="flex-1 flex flex-col">
        
        <!-- Header Section: Outlet Info, Shift Status, User Details, Terminal -->
        <header class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 border-b border-gray-200 px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Left Side: Outlet & Shift -->
                <div class="flex items-center gap-4">
                    <!-- Outlet Information -->
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                            <span class="text-lg">üè™</span>
                        </div>
                        <div>
                            <h2 class="font-bold text-lg">{{ request.user.outlet.name }}</h2>
                            <p class="text-xs text-gray-500">{{ request.user.outlet.company.name }}</p>
                        </div>
                    </div>
                    
                    <!-- Shift Status Indicator (HTMX auto-refresh every 30s) -->
                    <div id="shift-status-indicator" 
                         hx-get="{% url 'pos:shift_status' %}" 
                         hx-trigger="load, every 30s"
                         hx-swap="innerHTML">
                    </div>
                </div>
                
                <!-- Right Side: User & Terminal -->
                <div class="flex items-center gap-4">
                    <!-- User & DateTime -->
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-700">
                            {{ request.user.get_full_name|default:request.user.username }}
                        </p>
                        <p class="text-xs text-gray-500">{% now "l, d M Y \a\t h:i A" %}</p>
                    </div>
                    
                    <!-- Terminal Code Badge -->
                    {% if request.terminal %}
                    <div class="px-3 py-2 bg-gray-100 rounded-lg">
                        <p class="text-xs text-gray-500">Terminal</p>
                        <p class="text-sm font-mono font-semibold">{{ request.terminal.code }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </header>
        
        <!-- Category Filter Tabs (Horizontal Scroll) -->
        <nav class="bg-white border-b px-6 py-3">
            <div class="flex gap-3 overflow-x-auto">
                <!-- All Categories (Default Active) -->
                <button 
                    class="px-6 py-2 rounded-full bg-gray-900 text-white text-sm font-semibold category-btn whitespace-nowrap transition-all duration-200"
                    hx-get="{% url 'pos:products' %}?category=all"
                    hx-target="#product-grid"
                    hx-swap="innerHTML swap:200ms settle:300ms">
                    All
                </button>
                
                <!-- Dynamic Category Buttons -->
                {% for category in categories %}
                <button 
                    class="px-6 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-semibold category-btn whitespace-nowrap transition-all duration-200"
                    hx-get="{% url 'pos:products' %}?category={{ category.id }}"
                    hx-target="#product-grid"
                    hx-swap="innerHTML swap:200ms settle:300ms">
                    {{ category.name }}
                </button>
                {% endfor %}
            </div>
        </nav>
        
        <!-- Product Grid Container (4 columns, scrollable) -->
        <section id="product-grid" class="flex-1 p-6 overflow-y-auto bg-white" style="padding-bottom: 80px;">
            {% include 'pos/partials/product_grid.html' %}
        </section>
        
        <!-- Footer Action Buttons (2 Rows √ó 3 Buttons) - Glassmorphism Design -->
        <footer class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 border-t border-gray-200 shadow-2xl">
            
            <!-- Row 1: Bill Management Actions -->
            <div class="grid grid-cols-3 gap-2 p-2">
                <!-- Refresh (Always Active) -->
                <button 
                    class="group relative py-2 px-3 bg-gradient-to-br from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-bold rounded-lg border border-emerald-400 hover:border-emerald-300 transition-all duration-300 flex flex-col items-center justify-center gap-1 hover:scale-105 active:scale-95 shadow-md hover:shadow-xl"
                    onclick="location.reload()">
                    <svg class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" 
                              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span class="text-xs">Refresh</span>
                    <div class="absolute inset-0 rounded-lg bg-emerald-400/0 group-hover:bg-emerald-400/30 blur-xl transition-all duration-300"></div>
                </button>
                
                <!-- Split Bill (Requires Active Bill) -->
                <button 
                    class="group relative py-2 px-3 {% if bill %}bg-gradient-to-br from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 border-purple-400 hover:border-purple-300{% else %}bg-gradient-to-br from-gray-300 to-gray-400 border-gray-300{% endif %} text-white font-bold rounded-lg border transition-all duration-300 flex flex-col items-center justify-center gap-1 shadow-md {% if bill %}hover:scale-105 active:scale-95 hover:shadow-xl{% endif %} {% if not bill %}opacity-60 cursor-not-allowed{% endif %}"
                    {% if bill %}
                    hx-get="{% url 'pos:split_bill_modal' bill.id %}"
                    hx-target="#modal-container"
                    {% else %}
                    disabled
                    title="No active bill"
                    {% endif %}>
                    <svg class="w-4 h-4 {% if bill %}group-hover:scale-110{% endif %} transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" 
                              d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                    <span class="text-xs">Split Bill</span>
                    {% if bill %}
                    <div class="absolute inset-0 rounded-lg bg-purple-400/0 group-hover:bg-purple-400/30 blur-xl transition-all duration-300"></div>
                    {% endif %}
                </button>
            </div>
            
            <!-- Row 2: Table & Payment Actions -->
            <div class="grid grid-cols-3 gap-2 p-2 pt-0">
                <!-- Select Table (Always Active) -->
                <a href="{% url 'tables:floor_plan' %}" 
                    class="group relative py-2 px-3 bg-gradient-to-br from-rose-500 to-pink-600 hover:from-rose-600 hover:to-pink-700 text-white font-bold rounded-lg border border-rose-400 hover:border-rose-300 transition-all duration-300 flex flex-col items-center justify-center gap-1 hover:scale-105 active:scale-95 shadow-md hover:shadow-xl">
                    <svg class="w-4 h-4 group-hover:scale-110 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" 
                              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span class="text-xs">Select Table</span>
                    <div class="absolute inset-0 rounded-lg bg-rose-400/0 group-hover:bg-rose-400/30 blur-xl transition-all duration-300"></div>
                </a>
                
                <!-- Move Table (Requires Active Bill) -->
                <button 
                    class="group relative py-2 px-3 {% if bill %}bg-gradient-to-br from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 border-cyan-400 hover:border-cyan-300{% else %}bg-gradient-to-br from-gray-300 to-gray-400 border-gray-300{% endif %} text-white font-bold rounded-lg border transition-all duration-300 flex flex-col items-center justify-center gap-1 shadow-md {% if bill %}hover:scale-105 active:scale-95 hover:shadow-xl{% endif %} {% if not bill %}opacity-60 cursor-not-allowed{% endif %}"
                    {% if bill %}
                    hx-get="{% url 'pos:move_table_modal' bill.id %}"
                    hx-target="#modal-container"
                    {% else %}
                    disabled
                    title="No active bill"
                    {% endif %}>
                    <svg class="w-4 h-4 {% if bill %}group-hover:scale-110{% endif %} transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" 
                              d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                    <span class="text-xs">Move Table</span>
                    {% if bill %}
                    <div class="absolute inset-0 rounded-lg bg-cyan-400/0 group-hover:bg-cyan-400/30 blur-xl transition-all duration-300"></div>
                    {% endif %}
                </button>
                
                <!-- Payment (Requires Active Bill) -->
                <button 
                    class="group relative py-2 px-3 {% if bill %}bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 border-green-400 hover:border-green-300{% else %}bg-gradient-to-br from-gray-300 to-gray-400 border-gray-300{% endif %} text-white font-bold rounded-lg border transition-all duration-300 flex flex-col items-center justify-center gap-1 shadow-md {% if bill %}hover:scale-105 active:scale-95 hover:shadow-xl{% endif %} {% if not bill %}opacity-60 cursor-not-allowed{% endif %}"
                    {% if bill %}
                    hx-get="{% url 'pos:payment_modal' bill.id %}"
                    hx-target="#modal-container"
                    {% else %}
                    disabled
                    title="No active bill"
                    {% endif %}>
                    <svg class="w-4 h-4 {% if bill %}group-hover:scale-110{% endif %} transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" 
                              d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span class="text-xs font-bold">PAYMENT</span>
                    {% if bill %}
                    <div class="absolute inset-0 rounded-lg bg-green-400/0 group-hover:bg-green-400/30 blur-xl transition-all duration-300"></div>
                    {% endif %}
                </button>
            </div>
        </footer>
    </main>
    
    <!-- ==================== RIGHT: BILL PANEL ==================== -->
    <aside class="w-96 bg-white border-l flex flex-col shadow-lg" id="bill-panel">
        {% include 'pos/partials/bill_panel.html' %}
    </aside>
    
</div>

<!-- Modal Container for HTMX Modals -->
<div id="modal-container"></div>

<!-- JavaScript: Category Button Active State Management -->
<script>
// Ensure modal-container always exists on page load
document.addEventListener('DOMContentLoaded', function() {
    let modalContainer = document.getElementById('modal-container');
    if (!modalContainer) {
        modalContainer = document.createElement('div');
        modalContainer.id = 'modal-container';
        document.body.appendChild(modalContainer);
    }
});

/**
 * Updates active category button styling after product grid HTMX swap
 * Removes active state from all buttons and adds it to the clicked button
 */
document.addEventListener('htmx:afterSwap', function(event) {
    if (event.detail.target.id === 'product-grid') {
        // Remove active styling from all category buttons
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.remove('bg-gray-900', 'text-white');
            btn.classList.add('bg-gray-100', 'text-gray-700');
        });
        
        // Add active styling to clicked button
        event.detail.elt.classList.remove('bg-gray-100', 'text-gray-700');
        event.detail.elt.classList.add('bg-gray-900', 'text-white');
    }
});

/**
 * Ensure modal container exists before any HTMX request to it
 */
document.addEventListener('htmx:beforeRequest', function(event) {
    // Check if request is targeting modal-container
    const targetSelector = event.detail.elt.getAttribute('hx-target');
    if (targetSelector === '#modal-container') {
        // Ensure it exists
        let modalContainer = document.getElementById('modal-container');
        if (!modalContainer) {
            modalContainer = document.createElement('div');
            modalContainer.id = 'modal-container';
            document.body.appendChild(modalContainer);
            // Update the target reference
            event.detail.target = modalContainer;
        }
    }
});

/**
 * Handle HTMX target errors silently
 */
document.addEventListener('htmx:targetError', function(event) {
    const targetSelector = event.detail.elt.getAttribute('hx-target');
    
    if (targetSelector === '#modal-container') {
        // Recreate modal container if missing
        let modalContainer = document.getElementById('modal-container');
        if (!modalContainer) {
            modalContainer = document.createElement('div');
            modalContainer.id = 'modal-container';
            document.body.appendChild(modalContainer);
        }
        
        // Retry the request
        const url = event.detail.elt.getAttribute('hx-get') || event.detail.elt.getAttribute('hx-post');
        if (url) {
            htmx.ajax('GET', url, {target: '#modal-container', swap: 'innerHTML'});
        }
    }
});

/**
 * Ensure modal container doesn't get completely removed
 */
document.addEventListener('htmx:beforeSwap', function(event) {
    if (event.detail.target.id === 'modal-container') {
        // Allow the swap to happen normally
        event.detail.shouldSwap = true;
    }
});

/**
 * Clean up after HTMX requests to modal-container
 */
document.addEventListener('htmx:afterSwap', function(event) {
    if (event.detail.target.id === 'modal-container') {
        // Ensure button is re-enabled
        const heldBillsBtn = document.getElementById('held-bills-btn');
        if (heldBillsBtn) {
            heldBillsBtn.disabled = false;
            heldBillsBtn.classList.remove('htmx-request');
        }
        console.log('Modal content swapped successfully');
    }
    
    // Re-process HTMX attributes when bill-panel is updated (after resume or add item)
    if (event.detail.target.id === 'bill-panel') {
        // Use setTimeout to ensure DOM is fully updated
        setTimeout(function() {
            const billPanel = document.getElementById('bill-panel');
            if (billPanel) {
                // Force HTMX to re-process all elements inside
                htmx.process(billPanel);
                
                // Specifically re-enable the View Held Bills button
                const heldBillsBtn = document.getElementById('held-bills-btn');
                if (heldBillsBtn) {
                    heldBillsBtn.classList.remove('htmx-request', 'htmx-swapping');
                    heldBillsBtn.disabled = false;
                    htmx.process(heldBillsBtn);
                }
            }
            
            // Re-process product grid to enable Add buttons
            const productGrid = document.getElementById('product-grid');
            if (productGrid) {
                htmx.process(productGrid);
            }
        }, 50);
    }
});

/**
 * Global modal functions - Must be in main.html to persist after modal content swaps
 */
function closeHeldBillsModal() {
    const modalContainer = document.getElementById('modal-container');
    if (modalContainer) {
        // Clear content first
        modalContainer.innerHTML = '';
        
        // Force HTMX to re-process this element
        htmx.process(modalContainer);
        
        console.log('Held Bills modal closed and processed');
    }
}

function cancelHeldBill(billId) {
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    fetch(`/pos/bill/${billId}/cancel/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
        }
    }).then(response => {
        if (response.ok) {
            closeHeldBillsModal();
            // Refresh bill panel if active
            const billPanel = document.getElementById('bill-panel');
            if (billPanel) {
                htmx.trigger(billPanel, 'refreshBillPanel');
            }
        }
    });
}

/**
 * Show toast notification
 */
function showToast(message, type = 'info') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 ${
        type === 'warning' ? 'bg-yellow-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        type === 'success' ? 'bg-green-500 text-white' :
        'bg-blue-500 text-white'
    }`;
    toast.textContent = message;
    
    // Add to body
    document.body.appendChild(toast);
    
    // Animate in
    setTimeout(() => toast.style.opacity = '1', 10);
    
    // Remove after 3 seconds
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Listen for HTMX notification events
document.addEventListener('showNotification', function(event) {
    const detail = event.detail;
    showToast(detail.message, detail.type || 'info');
});
</script>

{% endblock %}