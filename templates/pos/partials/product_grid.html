{% load humanize %}
<!-- Product Grid - Fixed 3 columns for 1024x768 resolution -->
<div style="display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:0.75rem; width:100%; overflow:hidden;">
    {% for product in products %}
    {% include 'pos/partials/product_card.html' with product=product bill=bill bill_items_dict=bill_items_dict minio_endpoint=minio_endpoint minio_bucket=minio_bucket %}
    {% empty %}
    <!-- Empty State -->
    <div class="col-span-full text-center py-16">
        <div class="inline-flex flex-col items-center p-8 bg-white rounded-2xl shadow-sm">
            <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                </svg>
            </div>
            <p class="text-base font-bold text-gray-700 mb-1" style="font-family:'Outfit',sans-serif;">No Products Found</p>
            <p class="text-sm text-gray-400">Try selecting a different category</p>
        </div>
    </div>
    {% endfor %}
</div>

<script>
// Quick add/remove product functions
function quickAddProduct(billId, productId) {
    // Check if shift is active before allowing product operations
    if (!checkShiftActive()) {
        return;
    }
    
    fetch(`/pos/bill/${billId}/product/${productId}/quick-add/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCsrfToken(),
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            console.error('Error adding product:', data.error);
            return;
        }
        // Update product card
        const productCard = document.getElementById(`product-card-${productId}`);
        if (productCard) {
            productCard.outerHTML = data.product_card_html;
        }
        // Update bill panel
        const billPanel = document.getElementById('bill-panel');
        if (billPanel) {
            billPanel.outerHTML = data.bill_panel_html;
            
            // Trigger customer display update
            if (typeof updateCustomerDisplay === 'function') {
                setTimeout(() => {
                    updateCustomerDisplay([], 0);
                    console.log('ðŸ“º Customer display update triggered after quickAddProduct');
                }, 100);
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function quickRemoveProduct(billId, productId) {
    // Check if shift is active before allowing product operations
    if (!checkShiftActive()) {
        return;
    }
    
    fetch(`/pos/bill/${billId}/product/${productId}/quick-remove/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCsrfToken(),
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            console.error('Error removing product:', data.error);
            return;
        }
        // Update product card
        const productCard = document.getElementById(`product-card-${productId}`);
        if (productCard) {
            productCard.outerHTML = data.product_card_html;
        }
        // Update bill panel
        const billPanel = document.getElementById('bill-panel');
        if (billPanel) {
            billPanel.outerHTML = data.bill_panel_html;
            
            // Trigger customer display update
            if (typeof updateCustomerDisplay === 'function') {
                setTimeout(() => {
                    updateCustomerDisplay([], 0);
                    console.log('ðŸ“º Customer display update triggered after quickRemoveProduct');
                }, 100);
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function getCsrfToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
}
</script>
