{% load humanize %}

{% if bill %}
<div class="flex flex-col h-full">
    <!-- Bill Header -->
    <div class="p-4 border-b bg-white">
        <div class="flex justify-between items-center">
            <div>
                <span class="font-bold text-lg">{{ bill.bill_number }}</span>
                {% if bill.table %}
                <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">
                    {{ bill.table }}
                </span>
                {% endif %}
            </div>
            <span class="text-sm text-gray-500">{{ bill.guest_count }} Tamu</span>
        </div>
        <div class="text-sm text-gray-500 mt-1">
            {{ bill.created_at|date:"H:i" }} - {{ bill.created_by.username }}
        </div>
    </div>
    
    <!-- Bill Items -->
    <div id="bill-items" class="flex-1 overflow-y-auto touch-scroll">
        {% include 'pos/partials/bill_items.html' %}
    </div>
    
    <!-- Bill Totals -->
    <div class="border-t bg-white p-4 space-y-2">
        <div class="flex justify-between text-gray-600">
            <span>Subtotal</span>
            <span>Rp {{ bill.subtotal|floatformat:0|intcomma }}</span>
        </div>
        {% if bill.discount_amount > 0 %}
        <div class="flex justify-between text-red-600">
            <span>Discount</span>
            <span>-Rp {{ bill.discount_amount|floatformat:0|intcomma }}</span>
        </div>
        {% endif %}
        <div class="flex justify-between text-gray-600">
            <span>Tax ({{ bill.outlet.tax_rate }}%)</span>
            <span>Rp {{ bill.tax_amount|floatformat:0|intcomma }}</span>
        </div>
        <div class="flex justify-between text-gray-600">
            <span>Service ({{ bill.outlet.service_charge }}%)</span>
            <span>Rp {{ bill.service_charge|floatformat:0|intcomma }}</span>
        </div>
        <div class="flex justify-between font-bold text-xl pt-2 border-t">
            <span>Total</span>
            <span>Rp {{ bill.total|floatformat:0|intcomma }}</span>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="p-4 border-t bg-gray-100 grid grid-cols-2 gap-2">
        <button 
            class="px-4 py-3 rounded bg-yellow-500 text-white font-medium btn-touch"
            hx-post="{% url 'pos:hold_bill' bill.id %}"
            hx-target="#bill-panel"
            hx-confirm="Hold bill ini?"
        >
            Hold
        </button>
        <button 
            class="px-4 py-3 rounded bg-orange-500 text-white font-medium btn-touch"
            hx-post="{% url 'pos:send_to_kitchen' bill.id %}"
            hx-target="#bill-items"
        >
            Kitchen
        </button>
        <button 
            class="px-4 py-3 rounded bg-purple-500 text-white font-medium btn-touch"
            hx-get="{% url 'promotions:apply_promo_modal' bill.id %}"
            hx-target="#modal-container"
        >
            Promo
        </button>
        <button 
            class="px-4 py-3 rounded bg-green-600 text-white font-medium btn-touch"
            hx-get="{% url 'pos:payment_modal' bill.id %}"
            hx-target="#modal-container"
        >
            Bayar
        </button>
    </div>
</div>
{% else %}
<!-- No Active Bill -->
<div class="flex flex-col items-center justify-center h-full text-gray-500 p-4">
    <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
    </svg>
    <p class="mb-4 text-center">Tidak ada bill aktif</p>
    
    <div class="space-y-2 w-full">
        <button 
            class="w-full px-4 py-3 rounded bg-blue-600 text-white font-medium btn-touch"
            hx-get="{% url 'pos:select_table_modal' %}"
            hx-target="#modal-container"
        >
            Pilih Meja
        </button>
        <button 
            class="w-full px-4 py-3 rounded bg-green-600 text-white font-medium btn-touch"
            hx-post="{% url 'pos:open_bill' %}"
            hx-vals='{"bill_type": "takeaway"}'
            hx-target="#bill-panel"
        >
            Take Away
        </button>
    </div>
</div>
{% endif %}
