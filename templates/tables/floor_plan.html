{% extends 'base.html' %}
{% load static %}

{% block title %}Floor Plan - Table Management{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
    <!-- Header -->
    <div class="sticky top-0 z-50 backdrop-blur-md bg-white/80 border-b border-gray-200 shadow-sm">
        <div class="max-w-full mx-auto px-3 py-2">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h4a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM14 13a1 1 0 011-1h4a1 1 0 011 1v6a1 1 0 01-1 1h-4a1 1 0 01-1-1v-6z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-gray-900">Floor Plan</h1>
                            <p id="floor-plan-subtitle" class="text-xs text-gray-500">Tap table to create order ‚Ä¢ Long press for multi-select</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 text-xs">
                        <div class="flex items-center gap-1.5 px-2 py-1 bg-green-50 rounded-md border border-green-200">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="font-medium text-green-700">Available</span>
                        </div>
                        <div class="flex items-center gap-1.5 px-2 py-1 bg-red-50 rounded-md border border-red-200">
                            <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                            <span class="font-medium text-red-700">Occupied</span>
                        </div>
                        <div class="flex items-center gap-1.5 px-2 py-1 bg-purple-50 rounded-md border border-purple-200">
                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                            <span class="font-medium text-purple-700">Joined</span>
                        </div>
                        <div class="flex items-center gap-1.5 px-2 py-1 bg-gray-50 rounded-md border border-gray-200">
                            <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                            <span class="font-medium text-gray-700">Needs Cleaning</span>
                        </div>
                    </div>
                </div>

                <a href="{% url 'pos:main' %}" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-900 text-white text-sm font-semibold rounded-lg transition-all shadow hover:shadow-md flex items-center gap-1.5">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back
                </a>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="max-w-full px-3 py-3">
        {% if areas %}
            {% for area in areas %}
            <div class="mb-4">
                <div class="bg-white/90 rounded-lg shadow border border-gray-200">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-3 py-2 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 class="text-sm font-bold text-gray-900">{{ area.name }}</h2>
                            <span class="text-xs text-gray-600">{{ area.table_count }} tables</span>
                        </div>
                    </div>

                    <div class="p-3 overflow-auto">
                        <div class="floor-plan-canvas relative bg-gray-50 rounded-lg border border-dashed border-gray-200"
                             style="width: {{ area.floor_width|default:1200 }}px; height: {{ area.floor_height|default:800 }}px;{% if area.floor_image %} background-image: url('{{ area.floor_image.url }}'); background-size: cover; background-position: center;{% endif %}">
                            {% for table in area.active_tables %}
                            {% with pos_x=table.pos_x|default:0 pos_y=table.pos_y|default:0 %}
                            {% if pos_x == 0 and pos_y == 0 %}
                            <div class="absolute table-card group flex flex-col items-center"
                                 data-table-id="{{ table.id }}"
                                 data-table-number="{{ table.number }}"
                                 data-table-status="{{ table.status }}"
                                 data-is-joined="{{ table.table_group|yesno:'true,false' }}"
                                 style="left: {% widthratio forloop.counter0 1 80 %}px; top: {% widthratio forloop.counter0 8 80 %}px; margin-left: 50px; margin-top: 100px;">
                            {% else %}
                            <div class="absolute table-card group flex flex-col items-center"
                                 data-table-id="{{ table.id }}"
                                 data-table-number="{{ table.number }}"
                                 data-table-status="{{ table.status }}"
                                 data-is-joined="{{ table.table_group|yesno:'true,false' }}"
                                 style="left: {{ pos_x }}px; top: {{ pos_y }}px;">
                            {% endif %}
                            {% endwith %}
                                {% if table.table_group %}
                                <div class="absolute -top-1 -left-1 z-20">
                                    <div class="flex h-5 w-5 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full items-center justify-center shadow border border-white">
                                        <svg class="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                                        </svg>
                                    </div>
                                </div>
                                {% endif %}

                                <div class="absolute top-1 right-1 z-20 selection-checkbox hidden">
                                    <input type="checkbox"
                                           class="table-select-checkbox w-4 h-4 text-blue-600 rounded border border-white shadow cursor-pointer"
                                           data-table-id="{{ table.id }}"
                                           onclick="event.stopPropagation(); handleTableSelection()">
                                </div>

                                {% if table.status == 'dirty' %}
                                <form method="POST"
                                      action="{% url 'tables:clean_table' table.id %}"
                                      hx-post="{% url 'tables:clean_table' table.id %}"
                                      hx-target="body"
                                      hx-swap="outerHTML"
                                      class="table-form">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="table-button w-16 h-16 rounded-full border-2 transition-all transform hover:scale-105 active:scale-95 shadow hover:shadow-lg
                                            border-gray-300 bg-gradient-to-br from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 cursor-pointer flex items-center justify-center">
                                        <span class="text-gray-700 font-bold text-sm">{{ table.number }}</span>
                                    </button>
                                </form>
                                {% else %}
                                <form method="POST" action="{% url 'tables:open_table' table.id %}" class="table-form">
                                    {% csrf_token %}
                                    <button type="submit"
                                            {% if table.status == 'reserved' %}disabled{% endif %}
                                            class="table-button w-16 h-16 rounded-full border-2 transition-all transform hover:scale-105 active:scale-95 shadow hover:shadow-lg flex items-center justify-center
                                            {% if table.table_group %}
                                                border-purple-300 bg-gradient-to-br from-purple-50 to-indigo-50 hover:from-purple-100 hover:to-indigo-100 cursor-pointer
                                            {% elif table.status == 'available' %}
                                                border-green-300 bg-gradient-to-br from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 cursor-pointer
                                            {% elif table.status == 'occupied' %}
                                                border-red-300 bg-gradient-to-br from-red-50 to-pink-50 hover:from-red-100 hover:to-pink-100 cursor-pointer
                                            {% elif table.status == 'reserved' %}
                                                border-yellow-300 bg-gradient-to-br from-yellow-50 to-amber-50 cursor-not-allowed opacity-75
                                            {% else %}
                                                border-blue-300 bg-gradient-to-br from-blue-50 to-indigo-50
                                            {% endif %}">
                                        <span class="text-sm font-black
                                            {% if table.status == 'available' %}text-green-700
                                            {% elif table.status == 'occupied' %}text-red-700
                                            {% elif table.status == 'reserved' %}text-yellow-700
                                            {% elif table.status == 'dirty' %}text-gray-700
                                            {% else %}text-blue-700{% endif %}">
                                            {{ table.number }}
                                        </span>
                                    </button>
                                </form>
                                {% endif %}

                                <div class="mt-1 text-[10px] text-gray-600 font-semibold">üë• {{ table.capacity }}</div>

                                {% if table.status == 'occupied' %}
                                <div class="absolute -top-1 -right-1 z-10">
                                    <span class="flex h-5 w-5">
                                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                        <span class="relative inline-flex rounded-full h-5 w-5 bg-gradient-to-br from-red-500 to-red-600 items-center justify-center shadow">
                                            <svg class="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"></path>
                                            </svg>
                                        </span>
                                    </span>
                                </div>
                                {% endif %}

                                <div class="drag-handle absolute top-1 left-1 cursor-move opacity-0 group-hover:opacity-100 transition-opacity">
                                    <div class="w-4 h-4 bg-white/80 backdrop-blur-sm rounded shadow-sm flex items-center justify-center">
                                        <svg class="w-2.5 h-2.5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="backdrop-blur-md bg-white/60 rounded-2xl shadow-xl p-12 text-center">
                <div class="w-24 h-24 mx-auto bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mb-6">
                    <svg class="w-12 h-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-2">No Tables Configured</h3>
                <p class="text-gray-600 mb-6">Create table areas and tables to get started with your floor plan</p>
                <a href="{% url 'admin:tables_tablearea_changelist' %}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Setup Tables
                </a>
            </div>
        {% endif %}
    </div>
</div>

<div id="join-tables-btn" class="fixed bottom-16 left-1/2 transform -translate-x-1/2 z-50 hidden">
    <button onclick="joinTables()" class="px-5 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white text-sm font-bold rounded-full shadow-xl flex items-center gap-2 transition-all transform hover:scale-105 active:scale-95">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
        <span>Join <span id="selected-count" class="font-black">0</span></span>
    </button>
</div>

<div id="cancel-selection-btn" class="fixed bottom-16 right-4 z-50 hidden">
    <button onclick="cancelSelection()" class="w-10 h-10 bg-red-500 hover:bg-red-600 text-white font-bold rounded-full shadow-xl flex items-center justify-center transition-all transform hover:scale-110 active:scale-95">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
        </svg>
    </button>
</div>

<style>
.table-card {
    cursor: grab;
    user-select: none;
}

.table-card:active {
    cursor: grabbing;
}

.table-card.dragging {
    opacity: 0.4;
    transform: scale(0.9) rotate(3deg);
    z-index: 100;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}

.table-card.selected {
    transform: scale(1.05);
    border: 3px solid #8b5cf6 !important;
    box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.3), 0 20px 25px -5px rgba(0, 0, 0, 0.2) !important;
    z-index: 10;
}

.table-card.selection-mode {
    cursor: pointer !important;
}

.table-card.selection-mode .table-button {
    pointer-events: none;
}

.table-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.table-card:hover {
    z-index: 10;
}
</style>

<script>
// Use var or check existence to prevent redeclaration errors on HTMX swaps
var selectionMode = false;
var selectedTables = [];
var longPressTimer = null;
var LONG_PRESS_DURATION = 500;

var activeDragCard = null;
var dragOffset = { x: 0, y: 0 };
var dragCanvas = null;

document.addEventListener('DOMContentLoaded', function() {
    const tableCards = document.querySelectorAll('.table-card');

    tableCards.forEach(card => {
        const tableId = card.getAttribute('data-table-id');
        const tableStatus = card.getAttribute('data-table-status');

        card.addEventListener('mousedown', function(e) {
            if (e.button !== 0) return;
            longPressTimer = setTimeout(() => {
                if (tableStatus === 'occupied') {
                    enterSelectionMode();
                    toggleTableSelection(tableId, card);
                }
            }, LONG_PRESS_DURATION);
        });

        card.addEventListener('mouseup', clearLongPress);
        card.addEventListener('mouseleave', clearLongPress);
        card.addEventListener('touchstart', function() {
            longPressTimer = setTimeout(() => {
                if (tableStatus === 'occupied') {
                    enterSelectionMode();
                    toggleTableSelection(tableId, card);
                }
            }, LONG_PRESS_DURATION);
        });
        card.addEventListener('touchend', clearLongPress);
        card.addEventListener('touchcancel', clearLongPress);

        card.addEventListener('click', function(e) {
            if (selectionMode) {
                e.preventDefault();
                e.stopPropagation();
                if (tableStatus === 'occupied') {
                    toggleTableSelection(tableId, card);
                } else {
                    showNotification('‚ö†Ô∏è Only occupied tables can be joined', 'warning');
                }
            }
        });

        const dragHandle = card.querySelector('.drag-handle');
        if (dragHandle) {
            dragHandle.addEventListener('pointerdown', function(e) {
                if (selectionMode) return;
                const canvas = card.closest('.floor-plan-canvas');
                if (!canvas) return;

                activeDragCard = card;
                dragCanvas = canvas;
                const rect = card.getBoundingClientRect();
                dragOffset = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };

                card.classList.add('dragging');
                card.setPointerCapture(e.pointerId);
                showNotification('üí° Drag ke posisi yang diinginkan', 'info');
            });
        }
    });
});

document.addEventListener('pointermove', function(e) {
    if (!activeDragCard || !dragCanvas) return;
    e.preventDefault();

    const canvasRect = dragCanvas.getBoundingClientRect();
    const maxX = canvasRect.width - 64;
    const maxY = canvasRect.height - 64;

    let x = e.clientX - canvasRect.left - dragOffset.x;
    let y = e.clientY - canvasRect.top - dragOffset.y;

    x = Math.max(0, Math.min(x, maxX));
    y = Math.max(0, Math.min(y, maxY));

    activeDragCard.style.left = `${Math.round(x)}px`;
    activeDragCard.style.top = `${Math.round(y)}px`;
});

document.addEventListener('pointerup', function() {
    if (!activeDragCard) return;
    activeDragCard.classList.remove('dragging');
    saveTablePosition(activeDragCard);
    activeDragCard = null;
    dragCanvas = null;
});

function clearLongPress() {
    if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
    }
}

function enterSelectionMode() {
    if (selectionMode) return;

    selectionMode = true;
    document.querySelectorAll('.table-card').forEach(card => {
        card.classList.add('selection-mode');
        card.setAttribute('draggable', 'false');
        const checkbox = card.querySelector('.selection-checkbox');
        if (card.getAttribute('data-table-status') === 'occupied' && checkbox) {
            checkbox.classList.remove('hidden');
        }
    });

    const subtitle = document.getElementById('floor-plan-subtitle');
    if (subtitle) {
        subtitle.textContent = 'Selection mode: Tap tables to join';
    }
    showNotification('üìã Selection mode activated', 'info');
}

function exitSelectionMode() {
    selectionMode = false;
    selectedTables = [];

    document.querySelectorAll('.table-card').forEach(card => {
        card.classList.remove('selection-mode', 'selected');
        card.setAttribute('draggable', 'true');
        const checkbox = card.querySelector('.selection-checkbox');
        if (checkbox) {
            checkbox.classList.add('hidden');
            const input = checkbox.querySelector('input');
            if (input) input.checked = false;
        }
    });

    document.getElementById('join-tables-btn').classList.add('hidden');
    document.getElementById('cancel-selection-btn').classList.add('hidden');
    const subtitle = document.getElementById('floor-plan-subtitle');
    if (subtitle) {
        subtitle.textContent = 'Tap table to create order ‚Ä¢ Long press for multi-select';
    }
}

function toggleTableSelection(tableId, card) {
    const checkbox = card.querySelector('.table-select-checkbox');
    const isSelected = selectedTables.includes(tableId);

    if (isSelected) {
        selectedTables = selectedTables.filter(id => id !== tableId);
        card.classList.remove('selected');
        if (checkbox) checkbox.checked = false;
    } else {
        selectedTables.push(tableId);
        card.classList.add('selected');
        if (checkbox) checkbox.checked = true;
    }

    updateSelectionUI();
}

function handleTableSelection() {
    const checkboxes = document.querySelectorAll('.table-select-checkbox:checked');
    selectedTables = Array.from(checkboxes).map(cb => cb.getAttribute('data-table-id'));

    document.querySelectorAll('.table-card').forEach(card => {
        const tableId = card.getAttribute('data-table-id');
        if (selectedTables.includes(tableId)) {
            card.classList.add('selected');
        } else {
            card.classList.remove('selected');
        }
    });

    updateSelectionUI();
}

function updateSelectionUI() {
    const joinBtn = document.getElementById('join-tables-btn');
    const cancelBtn = document.getElementById('cancel-selection-btn');
    const countText = document.getElementById('selected-count');

    if (selectedTables.length >= 2) {
        joinBtn.classList.remove('hidden');
        cancelBtn.classList.remove('hidden');
        countText.textContent = `${selectedTables.length} tables selected`;
    } else if (selectedTables.length === 1) {
        joinBtn.classList.add('hidden');
        cancelBtn.classList.remove('hidden');
        countText.textContent = `${selectedTables.length} table selected`;
    } else {
        joinBtn.classList.add('hidden');
        cancelBtn.classList.add('hidden');
    }
}

function cancelSelection() {
    exitSelectionMode();
    showNotification('‚ùå Selection cancelled', 'info');
}

function joinTables() {
    if (selectedTables.length < 2) {
        showNotification('‚ö†Ô∏è Select at least 2 tables', 'warning');
        return;
    }

    let hasBill = false;
    for (const tableId of selectedTables) {
        const card = document.querySelector(`.table-card[data-table-id="${tableId}"]`);
        const status = card ? card.getAttribute('data-table-status') : '';
        if (status === 'occupied') {
            hasBill = true;
            break;
        }
    }

    if (!hasBill) {
        showNotification('‚ö†Ô∏è Please open at least one table and add items before joining', 'warning');
        return;
    }

    fetch('{% url "tables:join_tables" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ table_ids: selectedTables })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('‚úÖ Tables joined successfully!', 'success');
            exitSelectionMode();
            if (data.redirect_url) {
                setTimeout(() => { window.location.href = data.redirect_url; }, 1000);
            } else {
                setTimeout(() => window.location.reload(), 1500);
            }
        } else {
            showNotification('‚ö†Ô∏è ' + (data.error || 'Failed to join tables'), 'warning');
        }
    })
    .catch(() => {
        showNotification('‚ùå Error joining tables', 'warning');
    });
}

function saveTablePosition(card) {
    const tableId = card.getAttribute('data-table-id');
    if (!tableId) return;

    const posX = parseInt(card.style.left, 10) || 0;
    const posY = parseInt(card.style.top, 10) || 0;

    fetch('{% url "tables:update_table_position" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            table_id: tableId,
            pos_x: posX,
            pos_y: posY
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('‚úÖ Posisi meja tersimpan', 'success');
        } else {
            showNotification('‚ö†Ô∏è Gagal menyimpan posisi', 'warning');
        }
    })
    .catch(() => {
        showNotification('‚ö†Ô∏è Error menyimpan posisi', 'warning');
    });
}

function showNotification(message, type = 'info') {
    document.querySelectorAll('.toast-notification').forEach(n => n.remove());

    const notification = document.createElement('div');
    notification.className = `toast-notification fixed top-24 right-6 backdrop-blur-md ${
        type === 'success' ? 'bg-green-500/90' :
        type === 'info' ? 'bg-blue-500/90' :
        'bg-yellow-500/90'
    } text-white px-6 py-3 rounded-lg shadow-2xl z-50 font-semibold flex items-center gap-2`;
    notification.innerHTML = `<span>${message}</span>`;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        notification.style.transition = 'all 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
    }, 2500);
}
</script>
{% endblock %}
