{% load humanize %}

<!-- Held Bills Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
     onclick="if(event.target === this) closeHeldBillsModal()">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col overflow-hidden">
        <!-- Header -->
        <div class="bg-yellow-500 text-white px-6 py-4 flex items-center justify-between">
            <div class="flex items-center">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <h3 class="text-lg font-semibold">Held Bills</h3>
            </div>
            <button onclick="closeHeldBillsModal()"
                    class="text-white hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <!-- Body -->
        <div class="flex-1 overflow-y-auto p-6">
            {% if bills %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for bill in bills %}
                <div class="border border-gray-200 rounded-lg hover:shadow-md transition-shadow">
                    <!-- Bill Card Header -->
                    <div class="bg-gray-50 px-4 py-3 border-b flex items-center justify-between">
                        <div>
                            <span class="font-bold text-lg text-gray-800">{{ bill.bill_number }}</span>
                            {% if bill.table %}
                            <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium">
                                {{ bill.table }}
                            </span>
                            {% else %}
                            <span class="ml-2 px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs font-medium">
                                Take Away
                            </span>
                            {% endif %}
                        </div>
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium">
                            HOLD
                        </span>
                    </div>
                    
                    <!-- Bill Card Body -->
                    <div class="p-4 space-y-3">
                        <!-- Time & User Info -->
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            {{ bill.created_at|date:"d/m/Y H:i" }}
                            <span class="mx-2">â€¢</span>
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            {{ bill.created_by.username }}
                        </div>
                        
                        <!-- Items Summary -->
                        <div class="space-y-1">
                            {% for item in bill.items.all|slice:":3" %}
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-700">{{ item.quantity }}x {{ item.product.name }}</span>
                                <span class="text-gray-600">Rp {{ item.subtotal|floatformat:0|intcomma }}</span>
                            </div>
                            {% endfor %}
                            {% if bill.items.count > 3 %}
                            <div class="text-sm text-gray-500 italic">
                                +{{ bill.items.count|add:"-3" }} item lainnya...
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Hold Reason -->
                        {% if bill.notes %}
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-2">
                            <p class="text-xs text-yellow-800">
                                <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                                {{ bill.notes }}
                            </p>
                        </div>
                        {% endif %}
                        
                        <!-- Total -->
                        <div class="pt-2 border-t flex justify-between items-center">
                            <span class="font-semibold text-gray-700">Total:</span>
                            <span class="font-bold text-lg text-gray-900">Rp {{ bill.total|floatformat:0|intcomma }}</span>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex gap-2 pt-2">
                            <button 
                                class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 btn-touch"
                                hx-post="{% url 'pos:resume_bill' bill.id %}"
                                hx-target="#bill-panel"
                                hx-swap="outerHTML"
                                hx-on::after-request="closeHeldBillsModal(); 
                                    setTimeout(function() { 
                                        const billPanel = document.getElementById('bill-panel');
                                        if (billPanel) htmx.process(billPanel);
                                        // Trigger product grid refresh to show Add buttons
                                        const allBtn = document.querySelector('[hx-get*=category][hx-target=\'#product-grid\']');
                                        if (allBtn) htmx.trigger(allBtn, 'click');
                                    }, 50);"
                            >
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Resume
                            </button>
                            <button 
                                class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 btn-touch"
                                onclick="if(confirm('Yakin ingin cancel bill ini?')) { cancelHeldBill({{ bill.id }}) }"
                            >
                                <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Empty State -->
            <div class="text-center py-12">
                <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Tidak Ada Held Bills</h3>
                <p class="text-gray-500">Semua bill telah diproses atau belum ada bill yang di-hold</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 px-6 py-4 border-t flex justify-between items-center">
            <div class="text-sm text-gray-600">
                Total: <span class="font-semibold">{{ bills.count }}</span> held bill(s)
            </div>
            <button 
                class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 btn-touch"
                onclick="closeHeldBillsModal()">
                Tutup
            </button>
        </div>
    </div>
</div>
