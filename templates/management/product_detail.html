{% extends 'management/base.html' %}

{% block title %}{{ product.name }} - Product Detail{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-1.5">
    <!-- Header -->
    <div class="flex justify-between items-center mb-1.5">
        <div>
            <h1 class="text-xl font-bold text-gray-800">Product Details</h1>
            <p class="text-xs text-gray-600">View complete product information</p>
        </div>
        <div class="flex gap-1.5">
            <a href="{% url 'management:product_edit' product.id %}" 
               class="px-2.5 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center">
                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Edit Product
            </a>
            <a href="{% url 'management:products' %}" 
               class="px-2.5 py-1.5 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                ‚Üê Back to Products
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-2">
        <!-- Product Image & Basic Info -->
        <div class="lg:col-span-1 space-y-2">
            <!-- Image -->
            <div class="bg-white rounded-lg shadow p-2.5">
                <h3 class="text-sm font-semibold text-gray-800 mb-2">Product Image</h3>
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                     class="w-full rounded-lg shadow-md mb-2">
                {% else %}
                <div class="w-full h-48 bg-gray-200 rounded-lg flex items-center justify-center">
                    <div class="text-center text-gray-400">
                        <svg class="w-12 h-12 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <p class="text-xs">No Image</p>
                    </div>
                </div>
                {% endif %}
                
                <a href="{% url 'management:product_photos' product.id %}" 
                   class="block w-full px-2.5 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white text-center rounded-lg transition">
                    üì∑ Manage Photos ({{ product.photos.count }})
                </a>
            </div>

            <!-- Status -->
            <div class="bg-white rounded-lg shadow p-2.5">
                <h3 class="text-sm font-semibold text-gray-800 mb-2">Status</h3>
                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">Active Status</span>
                        {% if product.is_active %}
                        <span class="px-1.5 py-0.5 bg-green-100 text-green-700 text-xs font-semibold rounded">‚úì Active</span>
                        {% else %}
                        <span class="px-1.5 py-0.5 bg-red-100 text-red-700 text-xs font-semibold rounded">‚úó Inactive</span>
                        {% endif %}
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">Track Stock</span>
                        {% if product.track_stock %}
                        <span class="px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs font-semibold rounded">‚úì Yes</span>
                        {% else %}
                        <span class="px-1.5 py-0.5 bg-gray-100 text-gray-700 text-xs font-semibold rounded">‚úó No</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details -->
        <div class="lg:col-span-2 space-y-2">
            <!-- Basic Information -->
            <div class="bg-white rounded-lg shadow p-2.5">
                <h3 class="text-sm font-semibold text-gray-800 mb-2 border-b pb-1.5">Basic Information</h3>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Product Name</label>
                        <div class="text-sm font-semibold text-gray-900">{{ product.name }}</div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">PLU Product</label>
                        <div class="text-sm font-mono font-semibold text-indigo-600">{{ product.sku }}</div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Category</label>
                        <div class="text-xs text-gray-900">{{ product.category.name }}</div>
                    </div>
                    {% if product.description %}
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Menu Category</label>
                        <div class="text-xs text-gray-900 font-medium">{{ product.description }}</div>
                    </div>
                    {% endif %}
                    <div {% if not product.description %}class="col-span-2"{% endif %}>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Printer Target</label>
                        {% if product.printer_target == 'kitchen' %}
                        <span class="px-1.5 py-0.5 text-xs bg-orange-100 text-orange-700 rounded">üç≥ Kitchen</span>
                        {% elif product.printer_target == 'bar' %}
                        <span class="px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 rounded">üçπ Bar</span>
                        {% elif product.printer_target == 'dessert' %}
                        <span class="px-1.5 py-0.5 text-xs bg-pink-100 text-pink-700 rounded">üç∞ Dessert</span>
                        {% else %}
                        <span class="px-1.5 py-0.5 text-xs bg-gray-100 text-gray-700 rounded">No Print</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Pricing -->
            <div class="bg-white rounded-lg shadow p-2.5">
                <h3 class="text-sm font-semibold text-gray-800 mb-2 border-b pb-1.5">Pricing</h3>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Selling Price</label>
                        <div class="text-lg font-bold text-green-600">Rp {{ product.price|floatformat:0 }}</div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Cost Price</label>
                        <div class="text-lg font-bold text-gray-700">Rp {{ product.cost|floatformat:0 }}</div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Profit Margin</label>
                        {% if product.cost > 0 %}
                        {% widthratio product.price|add:"-product.cost" product.cost 100 as margin %}
                        <div class="text-lg font-bold text-blue-600">{{ margin }}%</div>
                        {% else %}
                        <div class="text-gray-400">-</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Stock Information -->
            {% if product.track_stock %}
            <div class="bg-white rounded-lg shadow p-2.5">
                <h3 class="text-sm font-semibold text-gray-800 mb-2 border-b pb-1.5">Stock Information</h3>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Current Stock</label>
                        <div class="text-lg font-bold {% if product.stock_quantity <= product.low_stock_alert %}text-red-600{% else %}text-green-600{% endif %}">
                            {{ product.stock_quantity }} units
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-0.5">Low Stock Alert</label>
                        <div class="text-lg font-bold text-orange-600">{{ product.low_stock_alert }} units</div>
                    </div>
                </div>
                {% if product.stock_quantity <= product.low_stock_alert %}
                <div class="mt-2 bg-red-50 border border-red-200 rounded-lg p-2">
                    <p class="text-red-700 text-xs font-medium">‚ö†Ô∏è Low stock alert! Current stock is below the minimum threshold.</p>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Modifiers / Condiments -->
            {% if product.modifiers.all %}
            <div class="bg-white rounded-lg shadow p-2.5">
                <h3 class="text-sm font-semibold text-gray-800 mb-2 border-b pb-1.5">üéõÔ∏è Condiments / Modifiers</h3>
                <div class="space-y-2">
                    {% for modifier in product.modifiers.all %}
                    <div class="border border-gray-200 rounded-lg p-2 bg-purple-50">
                        <div class="flex items-center justify-between mb-1">
                            <h4 class="text-xs font-semibold text-gray-900">
                                <span class="text-purple-600">Condiment:</span> {{ modifier.name }}
                            </h4>
                            <div class="text-xs text-gray-500">
                                {% if modifier.is_required %}
                                <span class="px-1.5 py-0.5 bg-red-100 text-red-700 rounded">Required</span>
                                {% else %}
                                <span class="px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded">Optional</span>
                                {% endif %}
                                <span class="ml-1">Max: {{ modifier.max_selections }}</span>
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            {% for option in modifier.options.all %}
                            <div class="flex items-center justify-between bg-white p-1.5 rounded border border-gray-200">
                                <div>
                                    <span class="text-xs text-gray-700 font-medium">{{ option.name }}</span>
                                </div>
                                <span class="font-semibold {% if option.price_adjustment > 0 %}text-green-600{% elif option.price_adjustment < 0 %}text-red-600{% else %}text-gray-600{% endif %}">
                                    {% if option.price_adjustment > 0 %}
                                    +Rp {{ option.price_adjustment|floatformat:0 }}
                                    {% elif option.price_adjustment < 0 %}
                                    Rp {{ option.price_adjustment|floatformat:0 }}
                                    {% else %}
                                    Free
                                    {% endif %}
                                </span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="bg-gray-50 rounded-lg p-2.5 text-center">
                <p class="text-xs text-gray-500">No condiments/modifiers for this product</p>
            </div>
            {% endif %}

            <!-- Timestamps -->
            <div class="bg-gray-50 rounded-lg p-2 text-xs text-gray-600">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <span class="font-medium">Created:</span> {{ product.created_at|date:"d M Y H:i" }}
                    </div>
                    <div>
                        <span class="font-medium">Last Updated:</span> {{ product.updated_at|date:"d M Y H:i" }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
