{% extends 'management/base.html' %}

{% block title %}{% if is_edit %}Edit User{% else %}Create User{% endif %} - Management{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-1.5">
    <div class="flex justify-between items-center mb-1.5">
        <div>
            <h1 class="text-xl font-bold text-gray-800">{% if is_edit %}Edit User{% else %}Create User{% endif %}</h1>
            <p class="text-xs text-gray-600">Staff account details</p>
        </div>
        <a href="{% url 'management:users' %}" class="px-2.5 py-1.5 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors text-xs">
            ‚Üê Back to Users
        </a>
    </div>

    {% if messages %}
    <div class="mb-2 space-y-2">
        {% for message in messages %}
        <div class="px-3 py-2 rounded-lg text-xs border
            {% if message.tags == 'error' %}bg-red-50 border-red-200 text-red-700
            {% elif message.tags == 'success' %}bg-green-50 border-green-200 text-green-700
            {% else %}bg-blue-50 border-blue-200 text-blue-700{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if error %}
    <div class="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg mb-2 text-xs">
        {{ error }}
    </div>
    {% endif %}

    <div class="bg-white rounded-lg shadow p-4">
        <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-3">
            {% csrf_token %}
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Username</label>
                <input type="text" name="username" value="{{ user_obj.username|default:'' }}" required
                       class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Email</label>
                <input type="email" name="email" value="{{ user_obj.email|default:'' }}"
                       class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">First Name</label>
                <input type="text" name="first_name" value="{{ user_obj.first_name|default:'' }}" required
                       class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Last Name</label>
                <input type="text" name="last_name" value="{{ user_obj.last_name|default:'' }}"
                       class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Role</label>
                <select name="role" required class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="admin" {% if user_obj.role == 'admin' %}selected{% endif %}>Admin</option>
                    <option value="manager" {% if user_obj.role == 'manager' %}selected{% endif %}>Manager</option>
                    <option value="cashier" {% if user_obj.role == 'cashier' %}selected{% endif %}>Cashier</option>
                    <option value="waiter" {% if user_obj.role == 'waiter' %}selected{% endif %}>Waiter</option>
                    <option value="kitchen" {% if user_obj.role == 'kitchen' %}selected{% endif %}>Kitchen</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Role Scope</label>
                <select name="role_scope" required class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="store" {% if user_obj.role_scope == 'store' or not user_obj.role_scope %}selected{% endif %}>Store Level</option>
                    <option value="brand" {% if user_obj.role_scope == 'brand' %}selected{% endif %}>Brand Level</option>
                    <option value="company" {% if user_obj.role_scope == 'company' %}selected{% endif %}>Company Level</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Brand Access</label>
                <select name="brand" class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">All Brands (Multi-Brand Access)</option>
                    {% for brand in available_brands %}
                    <option value="{{ brand.id }}" {% if user_obj.brand_id == brand.id %}selected{% endif %}>
                        {{ brand.name }}
                    </option>
                    {% endfor %}
                </select>
                <p class="text-xs text-gray-500 mt-1">Leave as "All Brands" for multi-brand access, or select specific brand to restrict access</p>
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-0.5">Password {% if is_edit %}(leave blank to keep){% endif %}</label>
                <input type="password" name="password" {% if not is_edit %}required{% endif %}
                       class="w-full px-2.5 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div class="md:col-span-2">
                <label class="inline-flex items-center text-xs text-gray-700">
                    <input type="checkbox" name="is_active" class="mr-2" {% if user_obj.is_active or not is_edit %}checked{% endif %}>
                    Active user
                </label>
            </div>
            <div class="md:col-span-2 flex justify-end gap-2">
                <a href="{% url 'management:users' %}" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-xs">Cancel</a>
                <button type="submit" class="px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-semibold">
                    {% if is_edit %}Save Changes{% else %}Create User{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
