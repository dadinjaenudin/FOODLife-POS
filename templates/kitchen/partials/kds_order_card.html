{% load humanize %}

<div class="bg-white rounded-lg shadow-lg overflow-hidden 
            {% if order.status == 'new' %}border-l-4 border-red-500{% endif %}
            {% if order.status == 'preparing' %}border-l-4 border-yellow-500{% endif %}">
    <!-- Header -->
    <div class="p-3 {% if order.status == 'new' %}bg-red-50{% else %}bg-yellow-50{% endif %}">
        <div class="flex justify-between items-center">
            <span class="font-bold text-xl">
                {% if order.bill.table %}
                    Meja {{ order.bill.table.number }}
                {% else %}
                    #{{ order.bill.queue_number|default:order.bill.bill_number }}
                {% endif %}
            </span>
            <span class="text-sm text-gray-500">
                {{ order.created_at|timesince }} lalu
            </span>
        </div>
        <div class="text-sm text-gray-600">
            {{ order.bill.bill_number }}
        </div>
    </div>
    
    <!-- Items -->
    <div class="p-3 space-y-2 max-h-60 overflow-y-auto">
        {% for item in order.bill.items.all %}
        {% if item.product.printer_target == order.station and not item.is_void %}
        <div class="{% if item.status == 'ready' %}line-through text-gray-400{% endif %}">
            <div class="flex gap-2">
                <span class="font-bold text-lg">{{ item.quantity }}x</span>
                <span class="font-medium">{{ item.product.name }}</span>
            </div>
            {% if item.modifiers %}
            <div class="text-sm text-gray-500 ml-6">
                {% for mod in item.modifiers %}
                - {{ mod.name }}<br>
                {% endfor %}
            </div>
            {% endif %}
            {% if item.notes %}
            <div class="text-sm text-red-600 ml-6 font-bold">
                âš  {{ item.notes }}
            </div>
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
    </div>
    
    <!-- Actions -->
    <div class="p-3 border-t">
        {% if order.status == 'new' %}
        <button 
            class="w-full py-3 rounded bg-yellow-500 text-white font-bold text-lg hover:bg-yellow-600"
            hx-post="{% url 'kitchen:kds_start' order.id %}"
            hx-target="closest div.bg-white"
            hx-swap="outerHTML"
        >
            MULAI MASAK
        </button>
        {% elif order.status == 'preparing' %}
        <button 
            class="w-full py-3 rounded bg-green-600 text-white font-bold text-lg hover:bg-green-700"
            hx-post="{% url 'kitchen:kds_ready' order.id %}"
            hx-swap="delete"
            hx-target="closest div.bg-white"
        >
            SIAP ANTAR
        </button>
        {% endif %}
    </div>
</div>
